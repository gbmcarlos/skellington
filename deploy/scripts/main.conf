<Macro VHost $port $basic_auth_enabled>

    ServerName web
    Listen $port
    <VirtualHost *:$port>

        DocumentRoot "/var/www/src/public"
        <Directory "/var/www/src/public">
            Options +Indexes +FollowSymLinks
            DirectoryIndex index.php
            AllowOverride None
            Order Allow,Deny
            Allow from All

            <IfModule mod_rewrite.c>
                Options -MultiViews
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !-f
                RewriteRule ^(.*)$ index.php [QSA,L]
            </IfModule>

            <If "'$basic_auth_enabled' == 'true'">
                AuthType Basic
                AuthName "Restricted Content"
                AuthUserFile /etc/apache2/.htpasswd
                Require valid-user
            </If>
        </Directory>
    </VirtualHost>
</Macro>

Use VHost ${PORT} ${BASIC_AUTH_ENABLED}